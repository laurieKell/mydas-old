---
title: "Task 2"
subtitle: "Productivity Analysis" 
author: "Laurie Kell & Alex Tidd"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
---

## Risk Based Approaches

```{r knitr, echo=FALSE}
library(knitr)

opts_chunk$set(comment=NA, fig.width =8, 
               fig.height=6,
               fig.path  ="../tex/",
               warning=FALSE, 
               message=FALSE, 
               error  =FALSE, 
               echo   =FALSE,
               cache  =TRUE)
iFig=0
iTab=0
```

```{r init}
library(DBI)
library(RPostgreSQL)
library(dplyr)
library(plyr)
library(reshape)
library(ggplot2)
library(maptools)

dirMy ="/home/laurence/Desktop/sea++/mydas/tasks"
dirInp=file.path(dirMy,"inputs")
dirDat=file.path(dirMy,"data")
 
options(scipen = 999)
theme_set(theme_bw())
```


```{r postgres}
drv  = dbDriver("PostgreSQL")

survey = dbGetQuery(con,"SELECT * FROM data_surveybio")

survey$hours = survey$hauldur_min/60

survtots = ddply(survey, .(year, survey_acronym, speciesgp), summarise, number=sum(number), effort=sum(hours))
survtots$cpue = survtots$number/survtots$effort 
ggplot(survtots, aes(as.factor(year), cpue)) + geom_boxplot() + facet_wrap(~speciesgp, scale="free_y")+expand_limits(y=0)+theme_bw() + 
 theme( text = element_text(size=16), strip.text.x = element_text(size = 16),strip.text.y = element_text(size = 16),
 panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.text.x = element_text(angle = 90, hjust = 1))+ylab("year")
```

